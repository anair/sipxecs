#!@BASH@

help() {
        echo "$0 [-from FROM] [-name NAME] -to TO [-subject SUBJECT] [-body BODY] FILE"
        exit 0
}

bail() {
        echo "$0: $1"
        exit 1
}

[ $# -eq 0 ] && help

while [ $# -gt 0 ]
do
        case "$1" in
                -from)
                        shift
                        [ $# -eq 0 ] && bail "-from requires an argument"
                        FROM=$1
                ;;
                -name)
                        shift
                        [ $# -eq 0 ] && bail "-name requires an argument"
                        NAME=$1
                ;;
                -to)
                        shift
                        [ $# -eq 0 ] && bail "-to requires an argument"
                        TO=$1
                ;;
                -subject)
                        shift
                        [ $# -eq 0 ] && bail "-subject requires an argument"
                        SUBJECT=$1
                ;;
                -body)
                        shift
                        [ $# -eq 0 ] && bail "-body requires an argument"
                        BODY=$1
                ;;
                *)
                        FILE=$1
                ;;
        esac
        shift
done

[ "$FILE" == "-" ] && FILE=
[ "$FROM" ] && FROM=-f$FROM
[ "$NAME" ] && NAME=-F$NAME

[ "$TO" ] || bail "need a destination address"
[ -z "$FILE" -o -f "$FILE" ] || bail "$FILE: no such file"

cd /tmp

(
       echo "Date: `date -R`"
       [ "$TO" ] && echo "To: $TO"
       [ "$SUBJECT" ] && echo "Subject: $SUBJECT"
       echo
       [ "$BODY" ] && echo "$BODY"
       [ "$FILE" -a -f "$FILE" ] && cat "$FILE"
) | /usr/sbin/sendmail "$NAME" "$FROM" -- $TO

# | mail -s "$SUBJECT" $TO
