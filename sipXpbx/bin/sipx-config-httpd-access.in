#!/bin/sh

HttpAccessConfig=@SIPX_CONFDIR@/httpd-sipxchange-common.conf
if [ -e "${HttpAccessConfig}.in" \
    -a \( ! -e "${HttpAccessConfig}" -o "${HttpAccessConfig}.in" -nt "${HttpAccessConfig}" \) ]
then
    fqdn=`hostname -f`
    iam=`whoami`
    if [ "${iam}" = "@SIPXPBXUSER@" ]
    then
        perl -pe "s/%FULLY_QUALIFIED_HOSTNAME%/${fqdn}/" ${HttpAccessConfig}.in > ${HttpAccessConfig} 
    elif [ "$iam" = "root" ]
    then
        su @SIPXPBXUSER@ -c "perl -pe \"s/%FULLY_QUALIFIED_HOSTNAME%/${fqdn}/\" ${HttpAccessConfig}.in > ${HttpAccessConfig} "
    else
        echo "sipx-config-httpd-access must be run as either root or @SIPXPBXUSER@" 1>&2
    fi
fi
