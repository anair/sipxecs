Notes on managing a sipX "interop server".

* DNS configuration

The SIPXCHANGE_DOMAIN_NAME name should have an ordinary DNS A record.

To support the "DNS SRV Record Processing" test, the INTEROP_ALIAS_UDP
and INTEROP_ALIAS_TCP names should have DNS SRV records like these:

_sip._tcp.{INTEROP_ALIAS_TCP}. IN SRV	1 1 5060 {SIPXCHANGE_DOMAIN_NAME}.
_sip._udp.{INTEROP_ALIAS_UDP}. IN SRV	1 1 5060 {SIPXCHANGE_DOMAIN_NAME}.

* To update the sipX code from a set of RPMs:

First, load the desired RPMs into a directory on the interop server.

    To load from a development build at Bluesocket, you need a two-step
    process to get the RPMs onto interop.pingtel.com, because interop is
    outside the firewall.

    From a machine inside Bluesocket, create a directory and download the
    RPMs for the desired version.  E.g.:

	    wget --no-parent -r -nd \
		    http://falcon.pingtel.com/ecs/main/FC/6/010020/RPM

    Create a destination directory on interop (e.g., ~/8551) and upload
    the RPMs to it:

	    scp *.rpm interop:8551

On the interop server, stop sipX and install the new PRMs:

	sudo /sbin/service sipxpbx stop

	sudo rpm --upgrade -p *.rpm

Note that rpm will attempt to install any RPMs that have the *same*
version as the currently installed version, as well as any that are
*newer*.  The former will fail (which causes the entire rpm command to
fail), so you have to inspect the output of rpm for messages like
this:

	package xerces-c-2.7.0-3 is already installed
	package ruby-gems-0.8.11-2 is already installed
	package cgicc-3.2.3-2 is already installed

Rename these RPMs to have a different extension (or delete them), and
run the rpm command again.

Do not install:

1) the sipXconfig RPMs (sipxconfig, sipxconfig-agent, sipxconfig-ftp,
sipxconfig-report, and sipxconfig-tftp), as the interop configuration
uses special config files

2) the Call Resolver (sipxproxy-cdr), as that requires Postgres to be
set up.

3) the sipxecs RPMs, as they are just umbrella packages that require
all the other RPMs

Once the RPMs are installed, restart sipX:

	sudo /sbin/service sipxpbx start

* To load or update the Interop sipX configuration:

Install the perl-XML-Parser RPM to provide XML/Parser.pm.

Create an updated working copy of the configuration files:

	svn co -q https://sipxecs.sipfoundry.org/rep/sipXecs/main/extras/interop-server-config

Edit the SIPX_USER line of ./Makefile to specify the correct user
name, the one that is in /etc/passwd -- open-source versions usually
use the name 'sipx' and commercial versions usually use the name
'sipxchange'.

Generate the config.defs file:

	cd ./interop.pingtel.com
	touch sipx_confdir/config.defs.in
	sudo make /etc/sipxpbx/config.defs

Edit /etc/sipxpbx/config.defs for any needed customization.

Generate the remainder of the configuration files:

	sudo make install

Restart sipX:

	sudo /sbin/service sipxpbx restart

* monitoring scripts

The directory "scripts" contains some scripts that are informative to
run every day.

Note that "registration-summary" executes "regtimes" (from sipXtools),
which requires the Perl module DateTime::Format::ISO8601.  You can
install that by executing:

	sudo cpan install DateTime::Format::ISO8601
