<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE page-specification PUBLIC
	"-//Apache Software Foundation//Tapestry Specification 4.0//EN"
	"http://jakarta.apache.org/tapestry/dtd/Tapestry_4_0.dtd">

<page-specification class="org.sipfoundry.sipxconfig.site.admin.commserver.Services">
  <description>Manage services</description>

  <!--
    - P R O P E R T I E S
  -->
  <inject property="sipxProcessContext" object="spring:sipxProcessContext" />
  <inject property="expressionEvaluator" object="service:tapestry.ognl.ExpressionEvaluator" />

  <property name="currentRow" />
  <property name="selections" initial-value="new org.sipfoundry.sipxconfig.components.SelectMap()" />
  <property name="servicesToStart" />
  <property name="servicesToStop" />
  <property name="servicesToRestart" />
  <property name="serviceLocation" />

  <!--
    - B E A N S
  -->
  <bean name="locationModel" class="org.sipfoundry.sipxconfig.components.ObjectSelectionModel" lifecycle="request">
    <set name="array" value="sipxProcessContext.locations" />
    <set name="labelExpression" value="literal:id" />
  </bean>
  <bean name="validator" class="org.sipfoundry.sipxconfig.components.SipxValidationDelegate" />
  <bean name="serverStatusConverter" class="org.sipfoundry.sipxconfig.site.admin.commserver.ServerStatusSqueezeAdapter" />

  <!--
    - C O M P O N E N T S
  -->
  <component id="form" type="Form">
    <binding name="listener" value="listener:formSubmit" />
    <binding name="delegate" value="bean:validator" />
  </component>

  <component id="locationPanel" type="FieldPanel">
    <binding name="field" value="components.locationSelection" />
    <binding name="label" value="message:label.locations" />
    <binding name="description" value="message:description.locations" />
  </component>
  <component id="locationSelection" type="PropertySelection">
    <binding name="value" value="serviceLocation" />
    <binding name="model" value="bean:locationModel" />
    <binding name="onchange" value="literal:javascript:this.form.submit();" />
  </component>

  <component id="renderLocation" type="If">
    <binding name="condition" value="sipxProcessContext.locations.length > 1" />
  </component>

  <component id="tableView" type="Table">
    <binding name="source" value="serviceStatus" />
    <binding name="selections" value="selections" />
    <binding name="columns" value="literal:* serviceName,status" />
    <binding name="usePager" value="false" />
    <binding name="converter" value="bean:serverStatusConverter" />
    <binding name="row" value="currentRow" />
  </component>

  <!-- Column 2: status -->
  <component id="viewStatusLabel" type="Insert">
    <binding name="value" value="ognl:messages.getMessage('status.' + currentRow.status.name)" />
  </component>

  <component id="startButton" type="Submit">
    <binding name="selected" value="servicesToStart" />
    <binding name="tag" value="selections.allSelected" />
    <binding name="value" value="message:button.start" />
  </component>
  <component id="stopButton" type="Submit">
    <binding name="selected" value="servicesToStop" />
    <binding name="tag" value="selections.allSelected" />
    <binding name="value" value="message:button.stop" />
  </component>
  <component id="restartButton" type="Submit">
    <binding name="selected" value="servicesToRestart" />
    <binding name="tag" value="selections.allSelected" />
    <binding name="value" value="message:button.restart" />
  </component>
  <component id="refreshButton" type="Submit">
    <binding name="value" value="message:button.refresh" />
  </component>

</page-specification>